{% extends 'base.html' %}

{% block content %}
<div class="profile-details">
    <h2>{{ profile.first_name }} {{ profile.last_name }}</h2>
    <img src="{{ profile.profile_image_url }}" alt="{{ profile.first_name }}'s profile image" style="width:400px;">
    <p><strong>City:</strong> {{ profile.city }}</p>
</div>

<!-- Display friends -->
<h3>Friends</h3>
<ul class="friends-list">
    {% for friend in profile.get_friends %}
    <li class="friend-item">
        <a href="{% url 'show_profile' friend.pk %}">
            <img src="{{ friend.profile_image_url }}" alt="{{ friend.first_name }}'s profile image" class="friend-image">
            {{ friend.first_name }} {{ friend.last_name }}
        </a>
    </li>
    {% empty %}
    <li>No friends yet.</li>
    {% endfor %}
</ul>

<!-- Add Friend button (only shown if viewing another profile and if user has a profile) -->
{% if request.user.is_authenticated and request.user.profile and profile != request.user.profile %}
    <a href="{% url 'add_friend' request.user.profile.pk profile.pk %}" class="button-link">Add Friend</a>
{% endif %}

<!-- Link to Friend Suggestions page -->
<div class="profile-actions">
    <a href="{% url 'friend_suggestions' profile.pk %}" class="button-link">Friend Suggestions</a>
</div>

<!-- Link to News Feed page -->
<div class="profile-actions">
    <a href="{% url 'news_feed' profile.pk %}" class="button-link">View News Feed</a>
</div>

<!-- Display status messages and associated images -->
<h3>Status Messages</h3>
<ul class="status-messages">
    {% for message in profile.get_status_messages %}
    <li>
        <strong>{{ message.timestamp|date:"M d, Y H:i" }}:</strong> {{ message.message }}
        
        <!-- Display associated images for this status message -->
        <div class="status-images">
            {% for img in message.get_images %}
            <img src="{{ img.image_file.url }}" alt="Image for {{ message.message }}" style="width:200px;">
            {% endfor %}
        </div>

        <!-- Add Update and Delete links for each status message -->
        <a href="{% url 'update_status' message.pk %}">Update</a> |
        <a href="{% url 'delete_status' message.pk %}">Delete</a>
    </li>
    {% empty %}
    <li>No status messages yet.</li>
    {% endfor %}
</ul>

<!-- Form to post a new status message (without file upload) -->
<h3>Post a New Status Message</h3>
<form method="post" action="{% url 'create_status' profile.pk %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="button-primary">Post Message</button>
</form>

<!-- Add buttons with improved styling -->
<div class="profile-actions">
    <a href="{% url 'show_all_profiles' %}" class="button-link">Back to all profiles</a>
    <a href="{% url 'update_profile' profile.pk %}" class="button-link">Update Profile</a>
</div>
{% endblock %}
